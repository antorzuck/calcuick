{% extends 'base.html' %}

{% block head %}
<!-- Chart.js for visualizations -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
.variety-card {
    transition: all 0.3s ease;
    cursor: pointer;
}
.variety-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}
.variety-card.selected {
    border-color: #10b981;
    background-color: #ecfdf5;
}
.dark .variety-card.selected {
    background-color: #064e3b;
}
.rootstock-card {
    transition: all 0.3s ease;
    cursor: pointer;
}
.rootstock-card:hover {
    transform: translateY(-1px);
}
.rootstock-card.selected {
    border-color: #f59e0b;
    background-color: #fef3c7;
}
.dark .rootstock-card.selected {
    background-color: #92400e;
}
.pattern-card {
    transition: all 0.3s ease;
    cursor: pointer;
}
.pattern-card.selected {
    border-color: #3b82f6;
    background-color: #dbeafe;
}
.dark .pattern-card.selected {
    background-color: #1e3a8a;
}
.orchard-display {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}
#orchard-canvas {
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    background: #f0fdf4;
}
.dark #orchard-canvas {
    border-color: #374151;
    background: #064e3b;
}
.metric-card {
    background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
}
.dark .metric-card {
    background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
}
</style>
{% endblock %}

{% block body %}
<!-- Main Content -->
<main class="max-w-6xl mx-auto px-4 py-8">
<!-- Back Button -->
<div class="mb-6">
    <button onclick="window.history.back()" class="flex items-center space-x-2 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors">
        <i data-lucide="arrow-left" class="w-5 h-5"></i>
        <span>Back to Calculators</span>
    </button>
</div>

<!-- Header -->
<div class="text-center mb-12">
    <div class="w-16 h-16 bg-green-50 dark:bg-green-900/30 rounded-xl flex items-center justify-center mx-auto mb-6">
        <i data-lucide="apple" class="w-8 h-8 text-green-600 dark:text-green-400"></i>
    </div>
    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4">Apple Tree Spacing Calculator</h1>
    <p class="text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
        Calculate optimal apple tree spacing for maximum yield, efficient orchard management, and sustainable fruit production.
    </p>
    <div class="mt-4 bg-green-50 dark:bg-green-900/20 p-4 rounded-lg inline-block">
        <div class="text-green-800 dark:text-green-300 font-medium">
            üå≥ Optimal Spacing ‚Ä¢ üçé Maximum Yield ‚Ä¢ üöú Equipment Access
        </div>
    </div>
</div>

<!-- Calculator -->
<div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-8 shadow-lg">
    <!-- Orchard Configuration -->
    <div class="mb-8">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Orchard Configuration</h2>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Left Column: Basic Settings -->
            <div class="space-y-6">
                <div>
                    <h3 class="font-medium text-gray-900 dark:text-white mb-3">Orchard Dimensions</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Length:</label>
                            <div class="relative">
                                <input type="number" id="orchard-length" value="100" min="10" max="1000" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <select id="length-unit" class="absolute right-2 top-3 bg-transparent text-gray-500 dark:text-gray-400 text-sm focus:outline-none">
                                    <option value="m">m</option>
                                    <option value="ft">ft</option>
                                    <option value="acres">acres</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Width:</label>
                            <div class="relative">
                                <input type="number" id="orchard-width" value="80" min="10" max="1000" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <select id="width-unit" class="absolute right-2 top-3 bg-transparent text-gray-500 dark:text-gray-400 text-sm focus:outline-none">
                                    <option value="m">m</option>
                                    <option value="ft">ft</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                        Total area: <span id="total-area">0.8 hectares</span>
                    </div>
                </div>

                <div>
                    <h3 class="font-medium text-gray-900 dark:text-white mb-3">Apple Variety</h3>
                    <div class="grid grid-cols-2 gap-3" id="variety-grid">
                        <!-- Variety cards will be populated by JavaScript -->
                    </div>
                </div>

                <div>
                    <h3 class="font-medium text-gray-900 dark:text-white mb-3">Rootstock Type</h3>
                    <div class="grid grid-cols-3 gap-3" id="rootstock-grid">
                        <!-- Rootstock cards will be populated by JavaScript -->
                    </div>
                </div>

                <div>
                    <h3 class="font-medium text-gray-900 dark:text-white mb-3">Environmental Conditions</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Climate Zone:</label>
                            <select id="climate-zone" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <option value="temperate">Temperate (USDA 5-7)</option>
                                <option value="cool">Cool (USDA 3-5)</option>
                                <option value="warm">Warm (USDA 7-9)</option>
                                <option value="continental">Continental</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Soil Quality:</label>
                            <select id="soil-quality" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <option value="excellent">Excellent</option>
                                <option value="good" selected>Good</option>
                                <option value="average">Average</option>
                                <option value="poor">Poor</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Advanced Settings -->
            <div class="space-y-6">
                <div>
                    <h3 class="font-medium text-gray-900 dark:text-white mb-3">Planting Pattern</h3>
                    <div class="grid grid-cols-2 gap-3" id="pattern-grid">
                        <!-- Pattern cards will be populated by JavaScript -->
                    </div>
                </div>

                <div>
                    <h3 class="font-medium text-gray-900 dark:text-white mb-3">Management System</h3>
                    <div class="space-y-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="mechanized" checked class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Mechanized Operations</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="irrigation" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Drip Irrigation System</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="intercropping" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Intercropping Planned</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="organic" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Organic Certification</span>
                        </label>
                    </div>
                </div>

                <div>
                    <h3 class="font-medium text-gray-900 dark:text-white mb-3">Custom Spacing (Optional)</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Row Spacing (m):</label>
                            <input type="number" id="custom-row-spacing" placeholder="Auto" min="2" max="10" step="0.5" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tree Spacing (m):</label>
                            <input type="number" id="custom-tree-spacing" placeholder="Auto" min="1" max="8" step="0.5" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- Orchard Layout Visualization -->
                <div>
                    <h3 class="font-medium text-gray-900 dark:text-white mb-3">Orchard Layout Preview</h3>
                    <div class="flex justify-center">
                        <canvas id="orchard-canvas" width="350" height="280"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Buttons -->
    <div class="flex flex-col sm:flex-row gap-4 mb-8">
        <button onclick="calculateSpacing()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 px-6 rounded-lg font-medium transition-colors duration-200">
            Calculate Optimal Spacing
        </button>
        <button onclick="clearCalculator()" class="flex-1 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-3 px-6 rounded-lg font-medium transition-colors duration-200">
            Clear
        </button>
    </div>

    <!-- Results -->
    <div id="result-container" class="hidden">
        <!-- Spacing Summary -->
        <div class="orchard-display text-white rounded-lg p-6 mb-6">
            <h3 class="text-xl font-semibold mb-4">Optimal Spacing Results</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="text-center">
                    <div id="row-spacing" class="text-3xl font-bold mb-2">0m</div>
                    <div class="text-sm opacity-90">Row Spacing</div>
                </div>
                
                <div class="text-center">
                    <div id="tree-spacing" class="text-3xl font-bold mb-2">0m</div>
                    <div class="text-sm opacity-90">Tree Spacing</div>
                </div>
                
                <div class="text-center">
                    <div id="trees-per-hectare" class="text-3xl font-bold mb-2">0</div>
                    <div class="text-sm opacity-90">Trees/Hectare</div>
                </div>
                
                <div class="text-center">
                    <div id="total-trees" class="text-3xl font-bold mb-2">0</div>
                    <div class="text-sm opacity-90">Total Trees</div>
                </div>
            </div>
        </div>

        <!-- Detailed Analysis -->
        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6 mb-6">
            <h3 class="text-xl font-semibold text-blue-800 dark:text-blue-300 mb-4">Orchard Analysis</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-medium text-blue-700 dark:text-blue-400 mb-3">Spacing Factors</h4>
                    <div class="space-y-2 text-gray-800 dark:text-gray-200">
                        <div class="flex justify-between">
                            <span>Variety:</span>
                            <span id="selected-variety" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Rootstock:</span>
                            <span id="selected-rootstock" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Pattern:</span>
                            <span id="selected-pattern" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Canopy Spread:</span>
                            <span id="canopy-spread" class="font-medium">-</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-medium text-blue-700 dark:text-blue-400 mb-3">Orchard Metrics</h4>
                    <div class="space-y-2 text-gray-800 dark:text-gray-200">
                        <div class="flex justify-between">
                            <span>Planting Area:</span>
                            <span id="planting-area" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Row Length:</span>
                            <span id="row-length" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Number of Rows:</span>
                            <span id="number-of-rows" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Trees per Row:</span>
                            <span id="trees-per-row" class="font-medium">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Yield Projections -->
        <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6 mb-6">
            <h3 class="text-xl font-semibold text-yellow-800 dark:text-yellow-300 mb-4">Yield Projections</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="metric-card p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">Year 3-5 (Young Trees)</h4>
                    <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400 mb-1" id="young-yield">0 kg</div>
                    <div class="text-sm text-gray-600 dark:text-gray-300">Per tree average</div>
                </div>
                
                <div class="metric-card p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">Year 6-10 (Mature Trees)</h4>
                    <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400 mb-1" id="mature-yield">0 kg</div>
                    <div class="text-sm text-gray-600 dark:text-gray-300">Per tree average</div>
                </div>
                
                <div class="metric-card p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">Total Orchard (Mature)</h4>
                    <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400 mb-1" id="total-yield">0 tonnes</div>
                    <div class="text-sm text-gray-600 dark:text-gray-300">Annual production</div>
                </div>
            </div>
        </div>

        <!-- Economic Analysis -->
        <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-6 mb-6">
            <h3 class="text-xl font-semibold text-green-800 dark:text-green-300 mb-4">Economic Analysis</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-medium text-green-700 dark:text-green-400 mb-3">Establishment Costs</h4>
                    <div class="space-y-2 text-gray-800 dark:text-gray-200">
                        <div class="flex justify-between">
                            <span>Tree Cost:</span>
                            <span id="tree-cost" class="font-medium">$0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Planting Cost:</span>
                            <span id="planting-cost" class="font-medium">$0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Infrastructure:</span>
                            <span id="infrastructure-cost" class="font-medium">$0</span>
                        </div>
                        <div class="flex justify-between border-t pt-2">
                            <span class="font-medium">Total Investment:</span>
                            <span id="total-investment" class="font-bold">$0</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-medium text-green-700 dark:text-green-400 mb-3">Revenue Potential</h4>
                    <div class="space-y-2 text-gray-800 dark:text-gray-200">
                        <div class="flex justify-between">
                            <span>Price per kg:</span>
                            <span id="price-per-kg" class="font-medium">$0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Annual Revenue:</span>
                            <span id="annual-revenue" class="font-medium">$0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Revenue per Tree:</span>
                            <span id="revenue-per-tree" class="font-medium">$0</span>
                        </div>
                        <div class="flex justify-between border-t pt-2">
                            <span class="font-medium">ROI (10 years):</span>
                            <span id="roi-percentage" class="font-bold">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Management Recommendations -->
        <div class="bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-6 mb-6">
            <h3 class="text-xl font-semibold text-purple-800 dark:text-purple-300 mb-4">Management Recommendations</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-medium text-purple-700 dark:text-purple-400 mb-2">Planting Guidelines</h4>
                    <ul id="planting-guidelines" class="list-disc list-inside space-y-1 text-gray-800 dark:text-gray-200">
                        <!-- Guidelines will be populated by JavaScript -->
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-medium text-purple-700 dark:text-purple-400 mb-2">Maintenance Tips</h4>
                    <ul id="maintenance-tips" class="list-disc list-inside space-y-1 text-gray-800 dark:text-gray-200">
                        <!-- Tips will be populated by JavaScript -->
                    </ul>
                </div>
            </div>
        </div>

        <!-- Pollination Chart -->
        <div class="bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-orange-800 dark:text-orange-300 mb-4">Pollination Requirements</h3>
            <div class="h-64">
                <canvas id="pollination-chart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Educational Content -->
<div class="mt-12 bg-gray-50 dark:bg-gray-800/50 rounded-xl p-8">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Apple Orchard Planning Guide</h2>
    
    <div class="space-y-6">
        <div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Why Proper Spacing Matters</h3>
            <p class="text-gray-600 dark:text-gray-300">
                Optimal tree spacing is crucial for apple orchard success. Proper spacing ensures adequate sunlight penetration, 
                air circulation, and root development while maximizing yield per hectare. It also facilitates efficient 
                mechanization, pest management, and harvesting operations.
            </p>
        </div>
        
        <div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Rootstock Selection Guide</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">üå± Dwarf Rootstock</h4>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-2">M9, M26, G41</p>
                    <p class="text-gray-600 dark:text-gray-300 text-sm">
                        2-3m height, early production, high density planting, requires support, easier harvesting.
                    </p>
                </div>
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">üåø Semi-Dwarf</h4>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-2">M7, MM106, G935</p>
                    <p class="text-gray-600 dark:text-gray-300 text-sm">
                        3-4m height, good balance of size and yield, moderate density, some support needed.
                    </p>
                </div>
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">üå≥ Standard</h4>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-2">MM111, M25, Seedling</p>
                    <p class="text-gray-600 dark:text-gray-300 text-sm">
                        4-6m height, long-lived, drought tolerant, lower density, traditional orchards.
                    </p>
                </div>
            </div>
        </div>
        
        <div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Planting Patterns</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">Square Pattern</h4>
                    <ul class="text-gray-600 dark:text-gray-300 text-sm space-y-1">
                        <li>‚Ä¢ Equal spacing in all directions</li>
                        <li>‚Ä¢ Easy mechanization</li>
                        <li>‚Ä¢ Good for uniform varieties</li>
                        <li>‚Ä¢ Standard commercial approach</li>
                    </ul>
                </div>
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">Rectangular Pattern</h4>
                    <ul class="text-gray-600 dark:text-gray-300 text-sm space-y-1">
                        <li>‚Ä¢ Different row and tree spacing</li>
                        <li>‚Ä¢ Optimizes equipment access</li>
                        <li>‚Ä¢ Better light penetration</li>
                        <li>‚Ä¢ Flexible for terrain</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Factors Affecting Spacing</h3>
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-medium text-gray-900 dark:text-white mb-2">Tree Factors</h4>
                        <ul class="list-disc list-inside space-y-1 text-gray-600 dark:text-gray-300 text-sm">
                            <li>Variety vigor and growth habit</li>
                            <li>Rootstock size control</li>
                            <li>Expected mature canopy size</li>
                            <li>Pruning and training system</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-900 dark:text-white mb-2">Environmental Factors</h4>
                        <ul class="list-disc list-inside space-y-1 text-gray-600 dark:text-gray-300 text-sm">
                            <li>Soil fertility and depth</li>
                            <li>Climate and growing season</li>
                            <li>Water availability</li>
                            <li>Slope and terrain</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Modern Orchard Systems</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">High Density</h4>
                    <p class="text-gray-600 dark:text-gray-300 text-sm">
                        1,000-2,500 trees/ha<br>
                        Dwarf rootstock, intensive management
                    </p>
                </div>
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">Super High Density</h4>
                    <p class="text-gray-600 dark:text-gray-300 text-sm">
                        2,500-5,000 trees/ha<br>
                        Wall systems, precise management
                    </p>
                </div>
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">Traditional</h4>
                    <p class="text-gray-600 dark:text-gray-300 text-sm">
                        200-400 trees/ha<br>
                        Standard rootstock, extensive system
                    </p>
                </div>
            </div>
        </div>
        
        <div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Pollination Considerations</h3>
            <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                <ul class="list-disc list-inside space-y-1 text-gray-800 dark:text-gray-200">
                    <li>Most apple varieties require cross-pollination</li>
                    <li>Plant 2-3 compatible varieties for optimal fruit set</li>
                    <li>Pollinizer trees should bloom at the same time</li>
                    <li>Maximum distance between varieties: 30-40 meters</li>
                    <li>Consider crabapple pollinizers for extended bloom</li>
                    <li>Ensure adequate bee populations during bloom</li>
                </ul>
            </div>
        </div>
        
        <div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">How to Use This Calculator</h3>
            <ol class="list-decimal list-inside space-y-2 text-gray-600 dark:text-gray-300">
                <li>Enter your orchard dimensions and select units</li>
                <li>Choose your apple variety and rootstock type</li>
                <li>Select environmental conditions and management preferences</li>
                <li>Choose a planting pattern or use custom spacing</li>
                <li>Click "Calculate Optimal Spacing" for detailed results</li>
                <li>Review spacing recommendations and yield projections</li>
                <li>Use the economic analysis for investment planning</li>
                <li>Follow management recommendations for best results</li>
            </ol>
        </div>
    </div>
</div>
</main>

<!-- JavaScript -->
<script>
// Apple varieties with characteristics
const appleVarieties = [
    { name: 'Gala', vigor: 'medium', icon: 'üçé', spacing: 3.5, yield: 45 },
    { name: 'Fuji', vigor: 'high', icon: 'üçé', spacing: 4.0, yield: 50 },
    { name: 'Granny Smith', vigor: 'high', icon: 'üçè', spacing: 4.0, yield: 48 },
    { name: 'Red Delicious', vigor: 'medium', icon: 'üçé', spacing: 3.5, yield: 42 },
    { name: 'Golden Delicious', vigor: 'medium', icon: 'üçé', spacing: 3.5, yield: 46 },
    { name: 'Honeycrisp', vigor: 'medium', icon: 'üçé', spacing: 3.8, yield: 40 },
    { name: 'Braeburn', vigor: 'high', icon: 'üçé', spacing: 4.0, yield: 47 },
    { name: 'Pink Lady', vigor: 'medium', icon: 'üçé', spacing: 3.8, yield: 44 }
];

// Rootstock types
const rootstockTypes = [
    { name: 'Dwarf', code: 'M9/G41', height: 2.5, spacing: 1.0, support: true, yield: 1.2 },
    { name: 'Semi-Dwarf', code: 'M7/MM106', height: 3.5, spacing: 1.3, support: false, yield: 1.0 },
    { name: 'Standard', code: 'MM111/M25', height: 5.0, spacing: 1.8, support: false, yield: 0.8 }
];

// Planting patterns
const plantingPatterns = [
    { name: 'Square', description: 'Equal spacing', efficiency: 1.0 },
    { name: 'Rectangular', description: 'Optimized rows', efficiency: 1.1 },
    { name: 'Triangular', description: 'Maximum density', efficiency: 1.15 },
    { name: 'Hedge Row', description: 'Linear system', efficiency: 1.25 }
];

let selectedVariety = appleVarieties[0];
let selectedRootstock = rootstockTypes[1];
let selectedPattern = plantingPatterns[0];
let canvas, ctx;
let pollinationChart = null;

// Initialize calculator
function initCalculator() {
    populateVarietyGrid();
    populateRootstock();
    populatePatterns();
    initCanvas();
    setupEventListeners();
    updateArea();
    drawOrchardLayout();
}

// Populate variety grid
function populateVarietyGrid() {
    const grid = document.getElementById('variety-grid');
    grid.innerHTML = '';

    appleVarieties.forEach((variety, index) => {
        const card = document.createElement('div');
        card.className = `variety-card bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3 text-center ${index === 0 ? 'selected' : ''}`;
        card.onclick = () => selectVariety(variety, card);
        
        card.innerHTML = `
            <div class="text-lg mb-1">${variety.icon}</div>
            <div class="font-medium text-gray-900 dark:text-white text-sm">${variety.name}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400">${variety.vigor} vigor</div>
        `;
        
        grid.appendChild(card);
    });
}

// Populate rootstock grid
function populateRootstock() {
    const grid = document.getElementById('rootstock-grid');
    grid.innerHTML = '';

    rootstockTypes.forEach((rootstock, index) => {
        const card = document.createElement('div');
        card.className = `rootstock-card bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3 text-center ${index === 1 ? 'selected' : ''}`;
        card.onclick = () => selectRootstock(rootstock, card);
        
        card.innerHTML = `
            <div class="font-medium text-gray-900 dark:text-white text-sm">${rootstock.name}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400">${rootstock.code}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400">${rootstock.height}m height</div>
        `;
        
        grid.appendChild(card);
    });
}

// Populate patterns grid
function populatePatterns() {
    const grid = document.getElementById('pattern-grid');
    grid.innerHTML = '';

    plantingPatterns.forEach((pattern, index) => {
        const card = document.createElement('div');
        card.className = `pattern-card bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3 text-center ${index === 0 ? 'selected' : ''}`;
        card.onclick = () => selectPattern(pattern, card);
        
        card.innerHTML = `
            <div class="font-medium text-gray-900 dark:text-white text-sm">${pattern.name}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400">${pattern.description}</div>
        `;
        
        grid.appendChild(card);
    });
}

// Select variety
function selectVariety(variety, cardElement) {
    document.querySelectorAll('.variety-card').forEach(card => card.classList.remove('selected'));
    cardElement.classList.add('selected');
    selectedVariety = variety;
    drawOrchardLayout();
}

// Select rootstock
function selectRootstock(rootstock, cardElement) {
    document.querySelectorAll('.rootstock-card').forEach(card => card.classList.remove('selected'));
    cardElement.classList.add('selected');
    selectedRootstock = rootstock;
    drawOrchardLayout();
}

// Select pattern
function selectPattern(pattern, cardElement) {
    document.querySelectorAll('.pattern-card').forEach(card => card.classList.remove('selected'));
    cardElement.classList.add('selected');
    selectedPattern = pattern;
    drawOrchardLayout();
}

// Initialize canvas
function initCanvas() {
    canvas = document.getElementById('orchard-canvas');
    ctx = canvas.getContext('2d');
}

// Setup event listeners
function setupEventListeners() {
    const inputs = ['orchard-length', 'orchard-width', 'custom-row-spacing', 'custom-tree-spacing'];
    inputs.forEach(id => {
        document.getElementById(id).addEventListener('input', () => {
            updateArea();
            drawOrchardLayout();
        });
    });
    
    document.getElementById('length-unit').addEventListener('change', updateArea);
    document.getElementById('width-unit').addEventListener('change', updateArea);
}

// Update area calculation
function updateArea() {
    const length = parseFloat(document.getElementById('orchard-length').value) || 0;
    const width = parseFloat(document.getElementById('orchard-width').value) || 0;
    const lengthUnit = document.getElementById('length-unit').value;
    const widthUnit = document.getElementById('width-unit').value;
    
    let lengthM = length;
    let widthM = width;
    
    // Convert to meters
    if (lengthUnit === 'ft') lengthM = length * 0.3048;
    if (lengthUnit === 'acres') {
        // For acres, assume square plot
        lengthM = Math.sqrt(length * 4047);
        widthM = lengthM;
        document.getElementById('orchard-width').value = Math.round(widthM);
    }
    
    if (widthUnit === 'ft') widthM = width * 0.3048;
    
    const areaHa = (lengthM * widthM) / 10000;
    document.getElementById('total-area').textContent = `${areaHa.toFixed(2)} hectares`;
}

// Calculate optimal spacing
function calculateOptimalSpacing() {
    const mechanized = document.getElementById('mechanized').checked;
    const irrigation = document.getElementById('irrigation').checked;
    const customRowSpacing = parseFloat(document.getElementById('custom-row-spacing').value);
    const customTreeSpacing = parseFloat(document.getElementById('custom-tree-spacing').value);
    
    let rowSpacing, treeSpacing;
    
    if (customRowSpacing && customTreeSpacing) {
        rowSpacing = customRowSpacing;
        treeSpacing = customTreeSpacing;
    } else {
        // Calculate based on variety and rootstock
        const baseSpacing = selectedVariety.spacing * selectedRootstock.spacing;
        
        // Adjust for mechanization
        const mechanizationFactor = mechanized ? 1.2 : 1.0;
        
        // Adjust for irrigation
        const irrigationFactor = irrigation ? 0.9 : 1.0;
        
        // Pattern efficiency
        const patternFactor = selectedPattern.efficiency;
        
        treeSpacing = baseSpacing * irrigationFactor;
        rowSpacing = baseSpacing * mechanizationFactor;
        
        // Apply pattern adjustments
        if (selectedPattern.name === 'Rectangular') {
            rowSpacing *= 1.2;
            treeSpacing *= 0.9;
        } else if (selectedPattern.name === 'Hedge Row') {
            rowSpacing *= 1.5;
            treeSpacing *= 0.7;
        }
    }
    
    return { rowSpacing, treeSpacing };
}

// Draw orchard layout
function drawOrchardLayout() {
    if (!ctx) return;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    const { rowSpacing, treeSpacing } = calculateOptimalSpacing();
    
    const isDark = document.documentElement.classList.contains('dark');
    const bgColor = isDark ? '#064e3b' : '#f0fdf4';
    const treeColor = '#10b981';
    const borderColor = isDark ? '#059669' : '#10b981';
    
    // Background
    ctx.fillStyle = bgColor;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Border
    ctx.strokeStyle = borderColor;
    ctx.lineWidth = 2;
    ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
    
    // Calculate scale
    const orchardWidth = canvas.width - 40;
    const orchardHeight = canvas.height - 40;
    const maxSpacing = Math.max(rowSpacing, treeSpacing);
    const scale = Math.min(orchardWidth / (rowSpacing * 8), orchardHeight / (treeSpacing * 6));
    
    // Draw trees
    const startX = 30;
    const startY = 30;
    const rows = Math.floor(orchardHeight / (rowSpacing * scale));
    const treesPerRow = Math.floor(orchardWidth / (treeSpacing * scale));
    
    ctx.fillStyle = treeColor;
    
    for (let row = 0; row < Math.min(rows, 8); row++) {
        for (let tree = 0; tree < Math.min(treesPerRow, 10); tree++) {
            const x = startX + (tree * treeSpacing * scale);
            const y = startY + (row * rowSpacing * scale);
            
            // Draw tree as circle
            ctx.beginPath();
            ctx.arc(x, y, 3, 0, 2 * Math.PI);
            ctx.fill();
        }
    }
    
    // Add labels
    ctx.fillStyle = isDark ? '#e5e7eb' : '#374151';
    ctx.font = '10px sans-serif';
    ctx.fillText(`${rowSpacing.toFixed(1)}m rows`, 10, canvas.height - 5);
    ctx.fillText(`${treeSpacing.toFixed(1)}m trees`, canvas.width - 60, canvas.height - 5);
}

// Calculate spacing
function calculateSpacing() {
    const length = parseFloat(document.getElementById('orchard-length').value) || 0;
    const width = parseFloat(document.getElementById('orchard-width').value) || 0;
    const lengthUnit = document.getElementById('length-unit').value;
    const widthUnit = document.getElementById('width-unit').value;
    
    // Convert to meters
    let lengthM = length;
    let widthM = width;
    
    if (lengthUnit === 'ft') lengthM = length * 0.3048;
    if (lengthUnit === 'acres') {
        lengthM = Math.sqrt(length * 4047);
        widthM = lengthM;
    }
    if (widthUnit === 'ft') widthM = width * 0.3048;
    
    const areaHa = (lengthM * widthM) / 10000;
    const { rowSpacing, treeSpacing } = calculateOptimalSpacing();
    
    // Calculate tree numbers
    const treesPerHa = 10000 / (rowSpacing * treeSpacing);
    const totalTrees = Math.floor(treesPerHa * areaHa);
    const numberOfRows = Math.floor(widthM / rowSpacing);
    const treesPerRow = Math.floor(lengthM / treeSpacing);
    const rowLength = lengthM;
    
    // Update main display
    document.getElementById('row-spacing').textContent = rowSpacing.toFixed(1) + 'm';
    document.getElementById('tree-spacing').textContent = treeSpacing.toFixed(1) + 'm';
    document.getElementById('trees-per-hectare').textContent = Math.round(treesPerHa);
    document.getElementById('total-trees').textContent = totalTrees;
    
    // Update analysis
    document.getElementById('selected-variety').textContent = selectedVariety.name;
    document.getElementById('selected-rootstock').textContent = selectedRootstock.name;
    document.getElementById('selected-pattern').textContent = selectedPattern.name;
    document.getElementById('canopy-spread').textContent = (selectedRootstock.height * 0.8).toFixed(1) + 'm';
    document.getElementById('planting-area').textContent = areaHa.toFixed(2) + ' ha';
    document.getElementById('row-length').textContent = rowLength.toFixed(0) + 'm';
    document.getElementById('number-of-rows').textContent = numberOfRows;
    document.getElementById('trees-per-row').textContent = treesPerRow;
    
    // Calculate yields
    const baseYieldPerTree = selectedVariety.yield * selectedRootstock.yield;
    const youngYield = baseYieldPerTree * 0.3;
    const matureYield = baseYieldPerTree;
    const totalYieldTonnes = (totalTrees * matureYield) / 1000;
    
    document.getElementById('young-yield').textContent = youngYield.toFixed(0) + ' kg';
    document.getElementById('mature-yield').textContent = matureYield.toFixed(0) + ' kg';
    document.getElementById('total-yield').textContent = totalYieldTonnes.toFixed(1) + ' tonnes';
    
    // Economic analysis
    const treeCost = 25; // USD per tree
    const plantingCostPerTree = 15;
    const infrastructureCostPerHa = 5000;
    
    const totalTreeCost = totalTrees * treeCost;
    const totalPlantingCost = totalTrees * plantingCostPerTree;
    const totalInfrastructure = areaHa * infrastructureCostPerHa;
    const totalInvestment = totalTreeCost + totalPlantingCost + totalInfrastructure;
    
    const pricePerKg = 2.5; // USD per kg
    const annualRevenue = totalYieldTonnes * 1000 * pricePerKg;
    const revenuePerTree = annualRevenue / totalTrees;
    const roi = ((annualRevenue * 10) - totalInvestment) / totalInvestment * 100;
    
    document.getElementById('tree-cost').textContent = '$' + totalTreeCost.toLocaleString();
    document.getElementById('planting-cost').textContent = '$' + totalPlantingCost.toLocaleString();
    document.getElementById('infrastructure-cost').textContent = '$' + totalInfrastructure.toLocaleString();
    document.getElementById('total-investment').textContent = '$' + totalInvestment.toLocaleString();
    document.getElementById('price-per-kg').textContent = '$' + pricePerKg.toFixed(2);
    document.getElementById('annual-revenue').textContent = '$' + annualRevenue.toLocaleString();
    document.getElementById('revenue-per-tree').textContent = '$' + revenuePerTree.toFixed(0);
    document.getElementById('roi-percentage').textContent = roi.toFixed(0) + '%';
    
    // Generate recommendations
    generateRecommendations(rowSpacing, treeSpacing, selectedRootstock);
    
    // Create pollination chart
    createPollinationChart();
    
    // Show results
    document.getElementById('result-container').classList.remove('hidden');
    
    // Scroll to results
    setTimeout(() => {
        document.getElementById('result-container').scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });
    }, 100);
}

// Generate recommendations
function generateRecommendations(rowSpacing, treeSpacing, rootstock) {
    const plantingGuidelines = [
        'Plant in early spring after last frost date',
        'Dig holes 2x wider than root ball, same depth',
        'Ensure proper drainage to prevent waterlogging',
        'Install support stakes for dwarf rootstocks',
        'Apply 5-10cm mulch around base, avoiding trunk'
    ];
    
    const maintenanceTips = [
        'Prune annually during dormant season',
        'Apply balanced fertilizer in early spring',
        'Monitor for pests and diseases regularly',
        'Thin fruits to 1 per cluster for quality',
        'Maintain consistent soil moisture'
    ];
    
    if (rootstock.support) {
        plantingGuidelines.push('Install trellis system for support');
        maintenanceTips.push('Check and adjust tree ties regularly');
    }
    
    if (rowSpacing > 4) {
        maintenanceTips.push('Consider intercropping between rows');
    }
    
    if (treeSpacing < 3) {
        maintenanceTips.push('Intensive pruning required for light penetration');
    }
    
    // Update DOM
    const guidelinesList = document.getElementById('planting-guidelines');
    guidelinesList.innerHTML = plantingGuidelines.map(tip => `<li>${tip}</li>`).join('');
    
    const tipsList = document.getElementById('maintenance-tips');
    tipsList.innerHTML = maintenanceTips.map(tip => `<li>${tip}</li>`).join('');
}

// Create pollination chart
function createPollinationChart() {
    const ctx = document.getElementById('pollination-chart').getContext('2d');
    
    if (pollinationChart) {
        pollinationChart.destroy();
    }
    
    // Sample pollination compatibility data
    const pollinationData = {
        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],
        datasets: [
            {
                label: selectedVariety.name,
                data: [0, 20, 80, 100, 60],
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                borderWidth: 2,
                fill: true
            },
            {
                label: 'Pollinizer Variety',
                data: [10, 60, 100, 80, 20],
                borderColor: '#f59e0b',
                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                borderWidth: 2,
                fill: true
            }
        ]
    };
    
    pollinationChart = new Chart(ctx, {
        type: 'line',
        data: pollinationData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Bloom Overlap for Cross-Pollination'
                },
                legend: {
                    position: 'top'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    title: {
                        display: true,
                        text: 'Bloom Intensity (%)'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Bloom Period'
                    }
                }
            }
        }
    });
}

// Clear calculator
function clearCalculator() {
    // Reset form values
    document.getElementById('orchard-length').value = '100';
    document.getElementById('orchard-width').value = '80';
    document.getElementById('length-unit').value = 'm';
    document.getElementById('width-unit').value = 'm';
    document.getElementById('climate-zone').value = 'temperate';
    document.getElementById('soil-quality').value = 'good';
    document.getElementById('mechanized').checked = true;
    document.getElementById('irrigation').checked = false;
    document.getElementById('intercropping').checked = false;
    document.getElementById('organic').checked = false;
    document.getElementById('custom-row-spacing').value = '';
    document.getElementById('custom-tree-spacing').value = '';
    
    // Reset selections
    selectedVariety = appleVarieties[0];
    selectedRootstock = rootstockTypes[1];
    selectedPattern = plantingPatterns[0];
    
    // Reset UI
    document.querySelectorAll('.variety-card').forEach((card, index) => {
        card.classList.toggle('selected', index === 0);
    });
    document.querySelectorAll('.rootstock-card').forEach((card, index) => {
        card.classList.toggle('selected', index === 1);
    });
    document.querySelectorAll('.pattern-card').forEach((card, index) => {
        card.classList.toggle('selected', index === 0);
    });
    
    // Hide results
    document.getElementById('result-container').classList.add('hidden');
    
    // Destroy chart
    if (pollinationChart) {
        pollinationChart.destroy();
        pollinationChart = null;
    }
    
    // Update displays
    updateArea();
    drawOrchardLayout();
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    initCalculator();
    lucide.createIcons();
});
</script>
{% endblock %}
